<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Audit Management</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      background: #f5f7fa;
    }
    h1 {
      color: #333;
    }
    form {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    input, select {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      grid-column: span 2;
      padding: 10px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    table {
      margin-top: 20px;
      width: 100%;
      border-collapse: collapse;
      background: white;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
    }
    th {
      background: #f0f0f0;
    }
  </style>
</head>
<body>

  <h1>Audit Management</h1>

  <form id="auditForm">
    <input type="text" name="Audit ID" placeholder="Audit ID" required>
    <input type="text" name="Firm Name" placeholder="Firm Name" required>
    <input type="text" name="Brand" placeholder="Brand" required>
    <input type="text" name="Location" placeholder="Location" required>
    <input type="text" name="City" placeholder="City" required>
    <input type="text" name="TL Name" placeholder="TL Name" required>
    <input type="date" name="Audit Date" required>
    <input type="time" name="Start Time" required>
    <input type="time" name="End Time" required>
    <select name="Status" required>
      <option value="">Select Status</option>
      <option>Completed</option>
      <option>Pending</option>
    </select>
    <input type="number" name="Expense" placeholder="Expense" required>
    <button type="submit">Add Audit</button>
  </form>

  <h2>All Audits</h2>
  <table id="auditTable">
    <thead></thead>
    <tbody></tbody>
  </table>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzQvSBuQMcYoBCMKT9rryKyo3ZICQbR7w9ScTkceHgVX4_AIlAj11Yk8gRp3ABfz0kZvg/exec';

    // Submit form
    document.getElementById('auditForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      const data = {};
      formData.forEach((val, key) => data[key] = val);

      try {
        const res = await fetch(scriptURL, {
          method: 'POST',
          body: JSON.stringify(data),
          headers: { 'Content-Type': 'application/json' }
        });
        const result = await res.json();
        alert(result.message || 'Success!');
        form.reset();
        fetchAudits(); // refresh table
      } catch (err) {
        alert("Failed to add audit. " + err);
      }
    });

    // Fetch audits from Google Sheets
    async function fetchAudits() {
      try {
        const res = await fetch(scriptURL);
        const audits = await res.json();
        const tableHead = document.querySelector('#auditTable thead');
        const tableBody = document.querySelector('#auditTable tbody');
        tableHead.innerHTML = '';
        tableBody.innerHTML = '';

        if (audits.length > 0) {
          const headers = Object.keys(audits[0]);
          const headRow = headers.map(h => `<th>${h}</th>`).join('');
          tableHead.innerHTML = `<tr>${headRow}</tr>`;

          audits.forEach(row => {
            const rowHTML = headers.map(h => `<td>${row[h] || ''}</td>`).join('');
            tableBody.innerHTML += `<tr>${rowHTML}</tr>`;
          });
        }
      } catch (err) {
        console.error("Error fetching audits:", err);
      }
    }

    fetchAudits();
  </script>
</body>
</html>
